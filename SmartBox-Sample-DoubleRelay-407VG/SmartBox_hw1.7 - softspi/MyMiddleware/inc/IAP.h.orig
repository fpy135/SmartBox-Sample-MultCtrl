

#ifndef __IAP_H
#define __IAP_H


#include "main.h"

typedef  void (*iapfun)(void);				//定义一个函数类型的参数.   

//#define MYCODE_SIZE 225280		//AI  220K
//#define UPDATA_AREA_ADDR	32*4096	  				// 更新数据存储地址   256k 根据片内flash 大小决定
//#define BACKUP_AREA_ADDR	0x39000 // 备份数据存储地址

#define CODE_LEN_ADDR			0 	// bin 文件长度
#define CODE_MD5_ADDR			4   // bin 文件CRC 高位在前
#define UPDATA_FLAG_ADDR		20	// 需要更新标识
#define UPEDN_FLAG_ADDR			21	// 更新失败标识
#define RESETCOUNT_ADDR			22	// 复位次数存储地址 

#define RESETCOUNT		10			// 触发退回更新的复位次数


#define iFLASH_SIZE			(256*1024)	// 内部flash 大小。
#define EXFLASH_SECTORS		4096		// 外部flash 一个擦除扇区大小
//#define CODE_SIZE			(iFLASH_SIZE-APP_START_ADDR)   //程序存储区内的代码大小 byte
//#define APP_START_ADDR		0x7800  //起始地址  注意地址请按1K对齐 或者4K对齐

extern void IAP_Init(void);
extern void IAP_Start(uint32_t AppAddr);
extern void IAP_Jump(uint32_t AppAddr);
extern void IAP_PRO(void);
 extern void rollback_Program(void);
 extern uint16_t CheckCodeCRC_Boot(uint8_t sw,uint32_t len);
 
extern void iap_load_app(uint32_t appxaddr);			//跳转到APP程序执行

#endif

